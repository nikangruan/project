<!DOCTYPE html>
<html>
  
  <head>
    <meta charset="UTF-8">
    <title>管理员添加</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8" />
     <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="../../../static/css/font.css">
	  <link rel="stylesheet" href="../../../static/css/xadmin.css">
	  <script src="../../../static/js/jquery.min.js"></script>
    <script src="../../../layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../../static/js/xadmin.js"></script>
    <!-- <script type="text/javascript" src="../../../ueditor/ueditor.all.js"></script> -->

    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
    	#description{width:700px;}
      #contents{width:1000px;}
      .pic-more,.pic-more1,.pic-more2{ width:100%; margin-left: 100px;margin-top:10px;}
      .pic-more li,.pic-more1 li,.pic-more2 li{ width:100px; float: left; margin-right: 5px;}
      .pic-more li .layui-input,.pic-more1 li .layui-input,.pic-more2 li .layui-input{ display: initial; }
      /* .pic-more li a,.pic-more1  li a { position: absolute; top: 0; display: block; }*/
      .pic-more li i,.pic-more1 li i,.pic-more2 li i { font-size: 24px; background-color: #008800;margin-left:10px;}  
      .item_img img,.item_img1 img,.item_img2 img{ width: 100px; height:100px;margin-left:10px;}
      #slide-pc-priview li,#slide-pc-priview1 li,#slide-pc-priview2 li{position: relative;}
      #slide-pc-priview li .operate,#slide-pc-priview1 li .operate1,#slide-pc-priview2 li .operate2{ color:#000;margin-top:5px; display: none;}
      #slide-pc-priview li .close,#slide-pc-priview1 li .close1,#slide-pc-priview2 li .close2{position: absolute;top: 5px;cursor:pointer;}
      #slide-pc-priview li:hover .operate,#slide-pc-priview1 li:hover .operate1,#slide-pc-priview2 li:hover .operate2{display: block;}
    </style>
  </head>
  <body>
    <div class="x-body">
        <form class="layui-form">
          <div class="layui-form-item">
              <label for="title" class="layui-form-label">
                  <span class="x-red">*</span>文章标题
              </label>
              <div class="layui-input-inline">
                  <input type="text" id="title" name="title" required lay-verify="required"
                  autocomplete="off" class="layui-input">
              </div>
              <div class="layui-form-mid layui-word-aux">
                  <span class="x-red">*</span>必填
              </div>
          </div>
          <div class="layui-form-item">
              <label for="keywords" class="layui-form-label">
                  <span class="x-red">*</span>关键词
              </label>
              <div class="layui-input-inline">
                  <input type="text" id="keywords" name="keywords" required lay-verify="keywords"
                  autocomplete="off" class="layui-input">
              </div>
              
          </div>
          <div class="layui-form-item">
              <label for="author" class="layui-form-label">
                  作者
              </label>
              <div class="layui-input-inline">
                  <input type="text" id="author" name="author" required lay-verify="author"
                  autocomplete="off" class="layui-input">
              </div>
             
          </div>
          <div class="layui-form-item">
              <label for="description" class="layui-form-label">
                  文章描述
              </label>
              <div class="layui-input-inline">
                  <!-- <input type="text" id="description" name="description" required lay-verify="description"
                  autocomplete="off" class="layui-input"> -->
                  <textarea name="description" id="description" cols="30" rows="3"></textarea>
              </div>
              
          </div>

          <div class="layui-form-item">
              <label for="contents" class="layui-form-label">
                  文章内容
              </label>
              <div class="layui-input-inline">
                  <script id="contents" name="contents" type="text/plain">
                    
                  </script>
                  <!-- <input type="text" id="description" name="description" required lay-verify="description"
                  autocomplete="off" class="layui-input"> -->
                  <!-- <textarea name="contents" id="contents" cols="30" rows="10"></textarea> -->
                  <!-- 配置文件 -->
                  <script type="text/javascript" src="../../../ueditor/ueditor.config.js"></script>
                  <!-- 编辑器源码文件 -->
                  <script type="text/javascript" src="../../../ueditor/ueditor.all.js"></script>
                  <!-- 实例化编辑器 -->
                  <script type="text/javascript">
                      var url="{:url('article/Ueditor/index')}";
                      var ue = UE.getEditor('contents', {
                          serverUrl :url  
                      });

                  </script>
                  
              </div>
              
          </div>
          <div class="layui-form-item">
              <label class="layui-form-label"><span class="x-red">*</span>文章类型</label>
              <div class="layui-input-block">
                <input type="radio" name="articletype" lay-skin="primary" value="1" title="新闻" >
                <input type="radio" name="articletype" lay-skin="primary" value="2" title="公告" >
                <input type="radio" name="articletype" lay-skin="primary" value="3" title="轮播图" checked="">
              </div>
          </div>
          <div class="layui-form-item">
              <label for="pic_url" class="layui-form-label">
                  链接地址
              </label>
              <div class="layui-input-inline">
                  <input type="text" id="pic_url" name="pic_url" required lay-verify="pic_url"
                  autocomplete="off" class="layui-input">
              </div>
              
          </div>
          <div class="layui-form-item">
              <label class="layui-form-label">轮播图</label>
              <div class="layui-upload">
              <button type="button" class="layui-btn" id="test2">图片上传</button> 
              <div class="pic-more">
                  <ul class="pic-more-upload-list" id="slide-pc-priview">
                  </ul>
                </div>
            </div>
          </div>
          <div class="layui-form-item">
              <label for="L_repass" class="layui-form-label">
              </label>
              <button  class="layui-btn" lay-filter="add" lay-submit="" id="sub">
                  确认添加
              </button>
          </div>
      </form>
    </div>
    <script>
        layui.use(['form','layer','upload'], function(){
          var $ = layui.jquery;
          var form = layui.form
          ,layer = layui.layer
          ,upload = layui.upload;
        
          //自定义验证规则
          form.verify({
            title: function(value){
              if(value.length < 5){
                return '用户名至少得5个字符啊';
              }
            }
            
          });
          //轮播图
          upload.render({
              elem: '#test2'
              ,url: 'uploadpic'
              ,multiple: true
              ,exts:'jpg|png|jpeg|gif'
              ,done: function(res){
                // console.log(res);
                  if(res.code == 1) {
                      $('#slide-pc-priview').append('\
                      <li class="item_img">\
                        <div class="operate">\
                          <i  class="close layui-icon"></i>\
                        </div>\
                        <img src="../../../'+res.path+'" class="img" >\
                        <input type="hidden" name="pc_src[]" value="' + res.path + '" />\
                      </li>\
                    ');
                  }else {
                    layer.msg(res.msg,{icon:2,time: 3000 });
                  }
              }

          });

          $("body").on("click",".close",function(){
            $(this).closest("li").remove();
            
          });
          $('#sub').click(function(){
            var arr =[];
            //轮播主图
            $('input[name="pc_src[]"]').each(function(){
                arr.push($(this).val());
            })
          	var data = {
          		  'title':$('#title').val(),
                'keywords':$('#keywords').val(),
                'author':$('#author').val(),
                'description':$('#description').val(),
                'contents':$('textarea[name="contents"]').val(),
                'type':$('input[name="articletype"]:checked').val(),
                'url':$('#pic_url').val(),
                'thumb':arr
          	}
          	// console.log(data);
          	$.ajax({
          		type:'post',
          		url:'add',
          		data:data,
          		async:false,
          		success:function(res){
          			// console.log(res);
          			if (res.code == 1) {
          				layer.msg(res.msg,{time:3000,icon:1},function(){
	          				var index = parent.layer.getFrameIndex(window.name);
			                //关闭当前frame
			                parent.layer.close(index);
                      parent.layui.table.reload('idTest');
          				});
                  // form.render();
          				
          			} else {
          				  layer.msg(res.msg,{time:4000,icon:2});
          			}
          		}
          		,error:function(){
          			alert('网络错误');
          		}
          	})
          	return false;
          });
          
        });
    </script>
  </body>

</html>